{% extends "shop/base.html" %}

{% block content %}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'shop/shop_style.css' %}">

    <div class="item">
        <img src="{{item.images.first.image.url}}" alt="">
        <p>{{ item.title }}</p>
        <button id="button{{forloop.counter}}" onclick="addCookieItem()">Add to Cart</button>
    </div>

<script>
    function addCookieItem(){
        console.log('Adding cookies')

		var cart = JSON.parse(getCookie('cart'))
        var itemId = {{item.id}}

        // Create Dict for new item
        itemDict = {}
        itemDict['style_groups'] = {}

        {% for style_group in item.style_groups.all %}
        itemDict['style_groups']['{{style_group.type}}'] = '{{style_group.styles.first}}'
        {% endfor %}

        console.log(itemDict)

        // Check if item already exists in cart
        if(cart.hasOwnProperty(itemId)){
            currentItemDict = cart[itemId]
            currentItemQuantity = cart[itemId]['quantity']
            delete cart[itemId]['quantity']
            if(JSON.stringify(currentItemDict) === JSON.stringify(itemDict)){
                delete cart[itemId]
                itemDict['quantity'] = currentItemQuantity + 1
            }
            else{
                itemDict['quantity'] = 1
            }
        }

        else{
            itemDict['quantity'] = 1
        }

        cart[itemId] = itemDict

        console.log('CART:', cart)
        document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"

        /*location.reload()*/
    }

</script>


{% endblock %}