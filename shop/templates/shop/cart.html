{% extends "shop/base.html" %}

{% block content %}

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'shop/cart_style.css' %}"
      xmlns:width="http://www.w3.org/1999/xhtml">

<div class="main">
    <ul class="left">
        <p class="your-bag-heading">Your bag</p>
        {% for cartItem in cartItems %}
        <li class="items-in-cart-list" id="item-in-cart-list-{{cartItem.cart_id}}">

            <img class="cartItem-image" src="{{cartItem.object.image_set.first.image.url}}" width= 100px alt="">
            <div class="cartItem-properties">
                <a class="cartItem-link" href="/item/{{seller}}/{{cartItem.object.id}}">{{cartItem.object.title|truncatechars:40}}</a>
                <p class="cartItem-description">{% for style_group, style in cartItem.style_groups.items %}{{style}}{% endfor %}</p>
                <p class="cartItem-price">{{cartItem.price|floatformat:2}}â‚¬</p>
                <p class="cartItem-quantity">Quantity: {{cartItem.quantity}}</p>

                <div class="remove-whole">
                    <img class="icon"
                    src="/media/icons/trashcan.png" alt="">
                    <button class="removeButton" onclick="removeCookieItem({{cartItem.cart_id}})">Remove</button>
                </div>
            </div>

        </li>

        {% endfor %}
    </ul>

    <div class="right" id="cart-total">
        {% include "shop/cart_total.html" %}
    </div>
</div>








<script>

    function removeCookieItem(cartItemId){
        delete cart[cartItemId]
        console.log('CART:', cart)
        document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"

        id_str = 'item-in-cart-list-' + cartItemId
        document.getElementById(id_str).style.display = 'None'

        getCartCount()

        updateCartTotal()
    }

    function updateCartTotal() {
        let request = new XMLHttpRequest();
        let method = 'GET';

        let url = '/cart_total';
        request.open(method, url);
        request.onload = function () {
            // the response is the rendered HTML
            // which django sends as return render(response, "your_template.html", context)
            let myHTML = request.response;
            // This is the important part
            // Set that HTML to the new, templated HTML returned by the server
        document.getElementById('cart-total').innerHTML = myHTML;
        };
        request.send();
    }

</script>


{% endblock %}