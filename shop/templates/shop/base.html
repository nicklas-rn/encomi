{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'shop/style.css' %}">

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <title>Title</title>


    <script>
            function delay(delayInms) {
              return new Promise(resolve => {
                setTimeout(() => {
                  resolve(2);
                }, delayInms);
              });
            }


        // Functions for adding and removing items from card via cookies

        function getCookie(name) {
		    // Split cookie string and get all individual name=value pairs in an array
		    var cookieArr = document.cookie.split(";");

		    // Loop through the array elements
		    for(var i = 0; i < cookieArr.length; i++) {
		        var cookiePair = cookieArr[i].split("=");

		        /* Removing whitespace at the beginning of the cookie name
		        and compare it with the given string */
		        if(name == cookiePair[0].trim()) {
		            // Decode the cookie value and return
		            return decodeURIComponent(cookiePair[1]);
		        }
		    }

		    // Return null if not found
		    return null;
		}

		var cart = JSON.parse(getCookie('cart'))

		if (cart == undefined){
			cart = {}
			console.log('Cart Created!', cart)
			document.cookie ='cart=' + JSON.stringify(cart) + ";domain=;path=/"
		}
		console.log('Cart:', cart)
    </script>

</head>

<body>


<nav>
    <div id="link-wrapper-nav">
        <a class="link-nav" href="#">Become a seller</a>
    </div>
    <a href="/"><img id="logo-nav" src="/media/logos/logo.png"></a>
    <div id="icon-wrapper-nav">
        <a href="/cart" onmouseenter="openCartPreview()"><img class="icon icon-nav" src="/media/icons/cart.svg"></a>
        <p id="badge-icon-cart-nav">0</p>
    </div>
</nav>

<div id="cart-preview" onmouseleave="closeCartPreview()">
    <a href="/cart"><div id="icon-edge-cart"></div></a>
    <p id="title-cart-preview">Your Cart</p>
    <div id="cartItems">
        {% for cartItem in cartItems %}
        <div class="cartItem">
            <img class="image-cartItem" src="{{cartItem.object.image_set.first.image.url}}" alt="">
            <div class="properties-cartItem">
                <a class="text-cartItem title-cartItem text-link" href="/item/{{cartItem.object.id}}">{{cartItem.object.title|truncatechars:40}}</a>
                <p class="text-cartItem description-cartItem">{% for style_group, style in cartItem.style_groups.items %}{{style}}{% endfor %}</p>
                <p class="text-cartItem price-cartItem">{{cartItem.price|floatformat:2}}€</p>
                <p class="text-cartItem quantity-cartItem">Quantity: {{cartItem.quantity}}</p>
                <button></button>
            </div>
        </div>
        {% endfor %}
    </div>
    <div id="infos-cart-preview">
        <p id="subtotal-cart-preview">Subtotal</p>
        <p id="subtotal-value-cart-preview">{{cartTotal|floatformat:2}}€</p>
        <br>
        <p id="delivery-cart-preview">Delivery Fee</p>
        <p id="delivery-fee-cart-preview">4,80€</p>
        <br>
        <a id="button-cart-preview" href="/cart">Go to Bag</a>
    </div>
</div>


{% block content %}

{% endblock %}

</body>

<style>
    #cart-preview{
        position: absolute;
        right: 20px;
        top: 50px;
        background-color: white;
        width: 300px;
        padding: 20px 20px 20px 20px;
        border: 1px solid black;
        z-index: 5;
        display: None;
    }

    #icon-edge-cart{
        position: absolute;
        top: -47px;
        right: -1px;
        border: 1px solid black;
        border-bottom: 1px solid white;
        width: 45px;
        height: 45px;
    }

    #title-cart-preview{
        margin-bottom: 20px;
        font-size: 25;
        font-family: 'Inria-Serif';
    }

    .cartItem{
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }

    .image-cartItem{
        width: 80px;
        margin-right: 20px;
    }

    .properties-cartItem{
        display: inline-block;
    }

    .title-cartItem{
        font-family: 'Inria-Serif';
        font-size: 17;
        margin-bottom: 7px;
    }

    .description-cartItem{
        font-size: 12;
        margin-bottom: 10px;
    }

    .price-cartItem{
        display: inline-block;
    }

    .quantity-cartItem{
        display: inline-block;
        float: right;
        font-size: 12;
        line-height: 20px;
        vertical-align: bottom;
    }


    #infos-cart-preview{
        margin-top: 25px;
    }

    #subtotal-cart-preview{
        display: inline-block;
        font-size: 17;
        margin-bottom: 10px;
    }

    #subtotal-value-cart-preview{
        display: inline-block;
        font-size: 17;
        margin-bottom: 10px;
        float: right;
    }

    #delivery-cart-preview{
        display: inline-block;
        font-size: 14;
        margin-bottom: 15px;
    }

    #delivery-fee-cart-preview{
        display: inline-block;
        font-size: 14;
        margin-bottom: 15px;
        float: right;
    }

    #button-cart-preview{
        background-color: black;
        color: white;
        font-size: 17;
        border-radius: 0;
        text-align: center;
        padding: 10px;
        display: block;
        outline: None;
        border: None;
    }
</style>

<script>
    function getCartCount() {
        let cart = JSON.parse(getCookie('cart'))
        let cartCount =  0
        for(let k in cart){
            cartCount += cart[k]['quantity']
        }
        document.getElementById('badge-icon-cart-nav').innerHTML = cartCount
    }

    getCartCount()

    function openCartPreview() {
        document.getElementById('cart-preview').style.display = 'block';
    }

    function closeCartPreview() {
        document.getElementById('cart-preview').style.display = 'None';
    }

</script>



</html>